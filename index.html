<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Digital Student Review and Relationship Management System</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="assets/css/styles.css" rel="stylesheet">
</head>
<body>
    <button class="theme-toggle" onclick="toggleTheme()">
        <i class="fas fa-moon"></i>
    </button>

    <div class="auth-container">
        <div class="auth-card">
            <h2 style="text-align: center; margin-bottom: 30px;">Login</h2>
            
            <form id="loginForm" onsubmit="handleLogin(event)">
                <div class="input-group">
                    <label for="email">Email</label>
                    <input type="email" id="email" class="input-field" required>
                    <div class="error-message" id="emailError"></div>
                </div>

                <div class="input-group">
                    <label for="password">Password</label>
                    <input type="password" id="password" class="input-field" required>
                    <div class="password-strength">
                        <div class="strength-meter"></div>
                    </div>
                    <div class="error-message" id="passwordError"></div>
                </div>
                              <button type="submit" class="btn">Login</button>
                
                              <button type="button" class="biometric-btn" onclick="handleBiometric()">
                                  <i class="fas fa-fingerprint"></i>
                              </button>

                              <div class="loader" id="loader"></div>
                              <div class="success-message" id="successMessage"></div>
                              <div class="error-message" id="generalError"></div>

                              <!-- Add this after the login button in the form -->
                              <p style="text-align: center; margin-top: 20px;">
                                  New user? 
                                  <a href="signup.html" style="color: var(--primary-light); text-decoration: none; font-weight: 600;">Create Account</a>
                              </p>
                          </form>
        </div>
    </div>

    <script>
        // Theme Toggle
        function toggleTheme() {
            document.body.classList.toggle('dark-mode');
            const icon = document.querySelector('.theme-toggle i');
            icon.classList.toggle('fa-moon');
            icon.classList.toggle('fa-sun');
        }

        // Password Strength Meter
        const passwordInput = document.getElementById('password');
        const strengthMeter = document.querySelector('.strength-meter');

        passwordInput.addEventListener('input', updateStrengthMeter);

        function updateStrengthMeter() {
            const password = passwordInput.value;
            const strength = calculatePasswordStrength(password);
            
            strengthMeter.className = 'strength-meter';
            if (strength > 80) strengthMeter.classList.add('strong');
            else if (strength > 50) strengthMeter.classList.add('medium');
            else if (strength > 0) strengthMeter.classList.add('weak');
        }

        function calculatePasswordStrength(password) {
            let strength = 0;
            if (password.length >= 8) strength += 20;
            if (password.match(/[a-z]+/)) strength += 20;
            if (password.match(/[A-Z]+/)) strength += 20;
            if (password.match(/[0-9]+/)) strength += 20;
            if (password.match(/[$@#&!]+/)) strength += 20;
            return strength;
        }

        // Biometric Authentication
        async function handleBiometric() {
            try {
                if (!window.PublicKeyCredential) {
                    throw new Error('WebAuthn not supported');
                }

                const loader = document.getElementById('loader');
                loader.style.display = 'block';

                // Check if biometric auth is available
                const available = await PublicKeyCredential.isUserVerifyingPlatformAuthenticatorAvailable();
                if (!available) {
                    throw new Error('Biometric authentication not available');
                }

                // Implement WebAuthn authentication here
                // This is a simplified version - you'll need to implement the full WebAuthn flow
                const credential = await navigator.credentials.get({
                    publicKey: {
                        challenge: new Uint8Array(32),
                        rpId: window.location.hostname,
                        allowCredentials: [],
                        userVerification: 'required'
                    }
                });

                // Handle successful authentication
                document.getElementById('successMessage').textContent = 'Biometric authentication successful';
                document.getElementById('successMessage').style.display = 'block';

            } catch (error) {
                document.getElementById('generalError').textContent = error.message;
                document.getElementById('generalError').style.display = 'block';
            } finally {
                document.getElementById('loader').style.display = 'none';
            }
        }

        // Login Handler
        async function handleLogin(event) {
            event.preventDefault();
            
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            const loader = document.getElementById('loader');
            
            // Reset error messages
            document.querySelectorAll('.error-message').forEach(el => el.style.display = 'none');
            document.getElementById('successMessage').style.display = 'none';
            
            try {
                loader.style.display = 'block';

                // Validate input
                if (!validateEmail(email)) {
                    throw new Error('Invalid email format');
                }

                if (!validatePassword(password)) {
                    throw new Error('Password must be at least 8 characters long');
                }

                // API call would go here
                await simulateApiCall({ email, password });

                document.getElementById('successMessage').textContent = 'Login successful';
                document.getElementById('successMessage').style.display = 'block';
                
                // Redirect to dashboard after successful login
                // window.location.href = '/dashboard';

            } catch (error) {
                document.getElementById('generalError').textContent = error.message;
                document.getElementById('generalError').style.display = 'block';
            } finally {
                loader.style.display = 'none';
            }
        }

        // Validation Functions
        function validateEmail(email) {
            return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
        }

        function validatePassword(password) {
            return password.length >= 8;
        }

        // Simulate API Call
        function simulateApiCall(data) {
            return new Promise((resolve, reject) => {
                setTimeout(() => {
                    if (Math.random() > 0.5) {
                        resolve({ success: true });
                    } else {
                        reject(new Error('Invalid credentials'));
                    }
                }, 1500);
            });
        }
    </script>
</body>
</html>